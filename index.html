<div class="container">
    <h2>WhatsApp Pairing</h2>
    <input type="text" id="number" placeholder="91xxxxxxxxxx">
    <button onclick="requestPairingCode()">Generate Code</button>
    
    <div id="result"></div>
    <div id="pairingCode" style="display:none; font-size: 2rem; color: #25d366; margin: 20px 0;"></div>
    
    <div id="sessionArea" style="display:none; margin-top:20px; padding:15px; background:rgba(255,255,255,0.1); border-radius:10px;">
        <p style="font-size: 0.8rem; color: #bb86fc;">YOUR SESSION ID:</p>
        <textarea id="sessionString" style="width:100%; height:100px; background:transparent; color:white; border:none; word-break:break-all;" readonly></textarea>
        <button onclick="copySession()" style="margin-top:10px; padding:5px;">Copy Session</button>
    </div>
</div>

<script>
    let checkInterval;

    async function requestPairingCode() {
        const num = document.getElementById('number').value;
        const resDiv = document.getElementById('result');
        const codeDiv = document.getElementById('pairingCode');
        
        resDiv.innerHTML = "â³ Generating...";
        
        const response = await fetch(`/pair?number=${num}`);
        const data = await response.json();
        
        if(data.code) {
            resDiv.innerHTML = "âœ… Link this code on WhatsApp. Waiting for connection...";
            codeDiv.innerText = data.code;
            codeDiv.style.display = 'block';
            
            // à´²à´¿à´™àµà´•àµ à´†à´¯àµ‹ à´Žà´¨àµà´¨àµ à´“à´°àµ‹ 5 à´¸àµ†à´•àµà´•à´¨àµà´±à´¿à´²àµà´‚ à´šàµ†à´•àµà´•àµ à´šàµ†à´¯àµà´¯àµà´•
            if(checkInterval) clearInterval(checkInterval);
            checkInterval = setInterval(() => checkStatus(data.sessionId), 5000);
        }
    }

    async function checkStatus(sid) {
        const response = await fetch(`/get-session?sessionId=${sid}`);
        const data = await response.json();
        
        if(data.success) {
            clearInterval(checkInterval);
            document.getElementById('sessionArea').style.display = 'block';
            document.getElementById('sessionString').value = data.session;
            document.getElementById('result').innerHTML = "ðŸŽ‰ Successfully Connected!";
        }
    }

    function copySession() {
        const txt = document.getElementById('sessionString');
        txt.select();
        document.execCommand('copy');
        alert("Session ID Copied!");
    }
</script>
